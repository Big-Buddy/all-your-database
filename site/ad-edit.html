<html>
<head>
	<title>Post an ad</title>
	<link href="/css/style.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="/js/functions.js"></script>

</head>
<body>
	<div class="container">
		<h1>Fill the form to submit an ad</h1>
		<table class="input-form input-form-large">
			<tr>
				<td>Email or Phone number</td>
				<td><input type="text" name="contact_info" id="contact_info"/></td>
			</tr>
			<tr>
				<td>Price - in CAD</td>
				<td><input type="text" name="price" id="price"/></td>
			</tr>	
			<tr>
				<td>Category</td>
				<td>
					<select id="category">
						<!-- this field is set based on select-region page -->						
						<option selected value="buy-sell">Buy/Sell</option>
						<option value="services">Services</option>
						<option value="rent">Rent</option>
						<option value="personals">Personals</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Owner or Business</td>
				<td>
					<select id="for_sale_by">						
						<option selected value="owner">Owner</option>
						<option value="business">Business</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Online or In-Store</td>
				<td>
					<select id="availability">						
						<option selected value="online">Online</option>
						<option value="instore">In-Store</option>
					</select>
				</td>
			</tr>	
			<tr>
				<td>Title</td>
				<td><input type="text" name="title" id="title" /> </td>
			</tr>
			<tr>
				<td>Description</td>
				<td><input type="text" name="description" id="description" /></td>
			</tr>
			<tr>
				<td>Address</td>
				<td><input type="text" name="address" id="address" /></td>
			</tr>
			<tr>
				<td>Image</td>
				<td><input type="file" name="pic" id="pic" accept="image/*"></td>
			</tr>
			
		</table>
		<p id="ad-error" class="error-msg" style="display:none;">Please enter all fields before submitting.</p>
		<a id="ad_submit" class="btn">Submit</a>
	</div>
</body>
<script>	
	$(document).ready(function(){
		//get URL params
		var category = getUrlParameter("category");
		switch(category){
			case "buy_sell":
				$("#category").val("buy-sell");
				break;
			case "services":
				$("#category").val("services");
				break;
			case "rent":
				$("#category").val("rent");
				break;
			case "personals":
				$("#category").val("personals");
				break;
			default:
				$("#category").val("buy-sell");
		}

		/****************************************
        				AD SUBMIT
		****************************************/
        $("#ad_submit").on('click', function(e){
        	e.preventDefault();
        	var contact_info = $("#contact_info").val();
        	var price = $("#price").val();
        	var category = $("#category").val();
			var for_sale_by = $("#for_sale_by").val();
			var availability = $("#availability").val();
        	var title = $("#title").val();
			var description = $("#description").val();
			var address = $("#address").val();
			var pic = $("#pic").val();
        	var isError = false;
        	$("#ad-error").hide();

        	//validation
        	if(contact_info == "" || contact_info == null || contact_info == undefined){
        		isError = true;
        	}
        	if(price == "" || price == null || price == undefined){
        		isError = true;
        	}
        	if(category == "" || category == null || category == undefined){
        		isError = true;
        	}
        	if(for_sale_by == "" || for_sale_by == null || for_sale_by == undefined){
        		isError = true;
        	}
        	if(availability == "" || availability == null || availability == undefined){
        		isError = true;
        	}
        	if(title == "" || title == null || title == undefined){
        		isError = true;
        	}
        	if(description == "" || description == null || description == undefined){
        		isError = true;
        	}
        	if(address == "" || address == null || address == undefined){
        		isError = true;
        	}
        	if(pic == "" || pic == null || pic == undefined){
        		isError = true;
        	}
        	// console.log("contact_info:" + contact_info + "price:" + price + "category:" +category+ "for_sale_by:" +for_sale_by+"availability:"+ availability+"title:" +title+ "description:"+ description + "address:" +address+"pic:"+pic);
        	if(isError){
        		$("#ad-error").show();
        	}        	
        	else{        		
        		//no errors, proceed with submit attempt
        		$.ajax({
		            url: '/php/post_ad.php',
		            type: 'POST',
					data: {
		                contact_info: contact_info,
						price: price,
						category: category,
						for_sale_by: for_sale_by,
						availability: availability,
						title: title,
						description: description,
						address: address,
						pic: pic
					},
		            success: function(response) {
		                //if response indicates ad post was successful...
		                //display success message
		                //redirect to /landing.html
		            },
		            error: function(err){
		            	alert("There was an error while trying to post your ad: " + JSON.stringify(err));
		            }
		        });
        	}        	
        });
	});
</script>
</html>